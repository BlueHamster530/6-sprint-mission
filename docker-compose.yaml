version: '3.8'

services:
  # 1. ë°ì´í„°ë² ì´ìŠ¤ ì»¨í…Œì´ë„ˆ (ê³¼ì œ ìš”êµ¬ì‚¬í•­ ë§Œì¡±)
  db:
    image: postgres:15-alpine
    container_name: pandamarket-db
    restart: always
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: pandamarket
    ports:
      - "5432:5432"
    volumes:
      # ì»¨í…Œì´ë„ˆê°€ êº¼ì ¸ë„ DB ë°ì´í„°ê°€ ë‚ ì•„ê°€ì§€ ì•Šë„ë¡ ì˜êµ¬ ì €ì¥
      - pgdata:/var/lib/postgresql/data 

  # 2. Express ì„œë²„ ì»¨í…Œì´ë„ˆ
  app:
    build: . # í˜„ì¬ í´ë”ì— ìˆëŠ” Dockerfileì„ ì½ì–´ì„œ ì´ë¯¸ì§€ë¥¼ êµ½ê² ë‹¤ëŠ” ëœ»!
    container_name: pandamarket-app
    restart: always
    # ê³¼ì œ ìš”êµ¬ì‚¬í•­: í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì—ì„œ 3000ë²ˆ í¬íŠ¸ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„
    ports:
      - "3000:3000"
    
    environment:
      # ğŸš¨ ì¤‘ìš”: ë„ì»¤ í™˜ê²½ì—ì„œëŠ” DB ì£¼ì†Œë¥¼ 'localhost' ëŒ€ì‹  ì„œë¹„ìŠ¤ ì´ë¦„ì¸ 'db'ë¡œ ì¨ì•¼ í•´!
      DATABASE_URL: "postgresql://postgres:postgres@db:5432/pandamarket?schema=public"
      
    volumes:
      # ê³¼ì œ ìš”êµ¬ì‚¬í•­: íŒŒì¼ ì—…ë¡œë“œ í´ë”ëŠ” Dockerì˜ Volume í™œìš©
      # ë‚´ ì»´í“¨í„°ì˜ ./uploads í´ë”ì™€ ë„ì»¤ ì•ˆì˜ /app/uploads í´ë”ë¥¼ ì—°ê²° (í´ë”ëª…ì€ ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” ê²½ë¡œì— ë§ê²Œ ìˆ˜ì •í•´!)
      - ./uploads:/app/uploads
      
    depends_on:
      - db # db ì»¨í…Œì´ë„ˆê°€ ë¨¼ì € ì¼œì§„ í›„ì— app ì»¨í…Œì´ë„ˆë¥¼ ì¼¬

volumes:
  pgdata: