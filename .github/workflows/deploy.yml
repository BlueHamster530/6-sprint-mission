name: Deploy to EC2

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to EC2
        uses: appleboy/ssh-action@v1.0.3 # ë²„ì „ì„ v1.0.3 ìµœì‹ ìœ¼ë¡œ ì˜¬ë¦¬ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤
        with:
          host: ${{ secrets.AWS_EC2_HOST }}
          username: ${{ secrets.AWS_EC2_USERNAME }}
          key: ${{ secrets.AWS_EC2_PEM_KEY }}
          port: 22
          script: |
            # 1. EC2 ë‚´ë¶€ì˜ í”„ë¡œì íŠ¸ í´ë”ë¡œ ì´ë™
            cd 6-sprint-mission 
            
            # 2. GitHubì—ì„œ ìµœì‹  ì½”ë“œ ë‹¹ê²¨ì˜¤ê¸°
            git pull origin main 
            
            # 3. ğŸš¨ ê¸°ì¡´ PM2 ë°©ì‹ ëŒ€ì‹  Docker Composeë¡œ ë¹Œë“œ ë° ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰!
            # npm installì´ë‚˜ build ëª…ë ¹ì–´ëŠ” Dockerfile ë‚´ë¶€ì—ì„œ ì•Œì•„ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
            docker-compose up -d --build
            
            echo "Docker Deployment successful!"