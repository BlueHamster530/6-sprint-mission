name: Deploy to EC2

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to EC2
        uses: appleboy/ssh-action@v1.0.3 # ë²„ì „ì„ v1.0.3 ìµœì‹ ìœ¼ë¡œ ì˜¬ë¦¬ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤
        with:
          host: ${{ secrets.AWS_EC2_HOST }}
          username: ${{ secrets.AWS_EC2_USERNAME }}
          key: ${{ secrets.AWS_EC2_PEM_KEY }}
          port: 22
          script: |
            set -e # ğŸš¨ ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨ (ê°€ì§œ ì„±ê³µ ë°©ì§€!)
            
            cd 6-sprint-mission
            git pull origin main
            
            # ë„ì»¤ ì»´í¬ì¦ˆê°€ í™•ì‹¤í•˜ê²Œ ì‹¤í–‰ë˜ë„ë¡ 'ì ˆëŒ€ ê²½ë¡œ'ë¥¼ ì§ì ‘ ëª…ì‹œ!
            /home/ec2-user/6-sprint-mission/docker-compose up -d --build
            
            echo "Deployment successful!"