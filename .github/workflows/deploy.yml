name: Deploy to EC2

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to EC2
        uses: appleboy/ssh-action@v1.0.3 # ë²„ì „ì„ v1.0.3 ìµœì‹ ìœ¼ë¡œ ì˜¬ë¦¬ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤
        with:
          host: ${{ secrets.AWS_EC2_HOST }}
          username: ${{ secrets.AWS_EC2_USERNAME }}
          key: ${{ secrets.AWS_EC2_PEM_KEY }}
          port: 22
          script: |
            set -e # ğŸš¨ ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨
            
            # 1. í”„ë¡œì íŠ¸ í´ë”ë¡œ ë¨¼ì € ì´ë™ (cd ëª…ë ¹ì–´ + í”„ë¡œì íŠ¸ ì ˆëŒ€ ê²½ë¡œ)
            cd /home/ec2-user/6-sprint-mission
            
            # 2. ê¹ƒí—ˆë¸Œì—ì„œ ìµœì‹  ì½”ë“œ ë‹¹ê²¨ì˜¤ê¸°
            git pull origin main
            
            # 3. ë„ì»¤ ì»´í¬ì¦ˆ ì‹¤í–‰ (ë„ì»¤ ì»´í¬ì¦ˆ í”„ë¡œê·¸ë¨ì˜ ì ˆëŒ€ ê²½ë¡œ)
            /usr/local/bin/docker-compose up -d --build
            
            echo "Deployment successful!"